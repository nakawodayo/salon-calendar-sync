# LINE アプリ仕様調査結果

**調査日**: 2025-11-11
**関連**: [Phase 1 要件定義](../logs/2025-11-11-phase1-requirements.md)

---

## LINE アプリ開発の選択肢

### 1. LINE ミニアプリ

- LINE アプリ内で動作するウェブアプリケーション
- インストール不要、LINE アカウントと連携可能
- 審査が必要（LINE ヤフー社による審査）
- 開発費用の目安: 委託開発で 300-500 万円程度（機能の複雑さによる）
- 導入事例: スシロー（来店予約・受付）、ジョルダン（乗り換え検索）

### 2. LIFF（LINE Front-end Framework）アプリ

- LINE トークルーム内で動作するウェブアプリケーション
- 比較的簡単に開発・公開可能
- LINE のユーザー ID などの情報を取得可能
- 審査不要（開発後すぐに公開可能）

---

## LINE ミニアプリ vs LIFF アプリの詳細比較

### 1. 友だち追加の必要性

- **LINE ミニアプリ**: 友だち追加不要で利用可能（利用ハードルが低い）
- **LIFF アプリ**: 友だち追加が必要（継続的なコミュニケーションが可能）

### 2. 審査・公開プロセス

- **LINE ミニアプリ**:
  - LINE ヤフー社による審査が必要
  - 審査期間: 約 2-4 週間
  - 開発の自由度が制限される場合がある（審査基準に準拠が必要）
- **LIFF アプリ**:
  - 審査不要
  - 開発完了後すぐに公開可能
  - 開発の自由度が高い

### 3. 動作環境

- **LINE ミニアプリ**: LINE アプリ内でのみ動作
- **LIFF アプリ**: LINE アプリ内 + 外部ブラウザ（Chrome、Safari、Firefox、Edge など）でも動作可能

### 4. 利用可能な機能

- **LINE ミニアプリ**:
  - 友だち追加がデフォルトでオン
  - **サービスメッセージ API 利用可能**（ユーザーへの通知送信が可能）
  - 予約・決済・会員証などの機能をスムーズに統合可能
- **LIFF アプリ**:
  - 友だち追加はデフォルトでオフ
  - **サービスメッセージ API は利用不可**（通知送信ができない）
  - ユーザー情報へのアクセスは可能

### 5. 適した用途

- **LINE ミニアプリ**:
  - 公式サービスとして LINE 上で展開したい場合
  - 予約・決済・会員証などの機能を統合したい場合
  - 広範なユーザーへのリーチや一時的なキャンペーン
  - ユーザーへの通知機能が必要な場合
- **LIFF アプリ**:
  - 開発の自由度を優先したい場合
  - とりあえず LINE 内で Web アプリを動かしたい場合
  - 既存ウェブサービスの LINE 統合
  - パーソナライズされたサービス提供

### 6. 今後の統合予定

- LINE は LIFF と LINE ミニアプリのブランド統合を予定
- 将来的には LIFF が LINE ミニアプリに統合される計画
- **新規開発時には LINE ミニアプリとして作成することが推奨**

### まとめ表

| 項目                   | LINE ミニアプリ   | LIFF アプリ                  |
| ---------------------- | ----------------- | ---------------------------- |
| 友だち追加             | 不要              | 必要                         |
| 審査                   | 必要（2-4 週間）  | 不要                         |
| 動作環境               | LINE アプリ内のみ | LINE アプリ内 + 外部ブラウザ |
| サービスメッセージ API | 利用可能          | 利用不可                     |
| 開発の自由度           | 審査により制限    | 高い                         |
| 公開までの期間         | 長い（審査含む）  | 短い（即時可能）             |
| 通知機能               | 可能              | 不可                         |

---

## 技術スタック

- **LINE 公式アカウント**: 法人向けサービスとして統合
- **Messaging API**: 双方向コミュニケーション（メッセージ送受信、ユーザー情報取得）
- **Webhook**: ユーザーからのメッセージ受信、イベント処理
- **LINE ログイン**: LINE アカウントでの外部サービスログイン
- **プロフィール+**: ユーザーの LINE プロフィール情報取得

---

## ユーザー認証・プロフィール情報取得

### LIFF アプリでの取得方法

LIFF アプリでは、ログイン中のユーザーの認証情報・プロフィール情報を取得可能です。これにより、予約リクエスト時の名前入力を省略したり、次の予約情報を表示する際にユーザー名を表示できます。

#### 取得可能な情報

- **ユーザー ID**: LINE ユーザー ID（一意の識別子）
- **表示名**: LINE アプリで設定されている表示名
- **プロフィール画像 URL**: プロフィール画像の URL
- **メールアドレス**: 追加設定が必要（後述）

#### 取得方法

1. **クライアントサイドでの取得（`liff.getProfile()`）**

   - LIFF SDK の `liff.getProfile()` メソッドを使用
   - クライアントサイドで直接プロフィール情報を取得可能
   - 取得できる情報: ユーザー ID、表示名、プロフィール画像 URL

2. **サーバーサイドでの取得（推奨）**
   - `liff.getAccessToken()` でアクセストークンを取得
   - アクセストークンをサーバーに送信
   - サーバーサイドで LINE プラットフォームの API を通じてユーザー情報を取得
   - **セキュリティとプライバシーの観点から推奨**

#### メールアドレス取得の追加設定

メールアドレスを取得する場合:

- LINE ログインチャネルの「LIFF」設定で、Scope（スコープ）に「email」を含める
- ユーザーが LIFF アプリを初めて利用する際に、メールアドレス提供の許可を求める認証画面が表示される
- ユーザーが許可すると、メールアドレスの取得が可能

#### 活用例

- **予約リクエスト時の名前入力省略**: `liff.getProfile()` で取得した表示名を自動入力
- **次の予約情報の表示**: ユーザー名を表示して「○○ さんの次の予約は...」と表示
- **パーソナライズされた UI**: ユーザー名やプロフィール画像を表示

#### 注意点

- ユーザー情報の取得・利用時は、プライバシー保護とセキュリティに注意
- LINE の開発ガイドラインに従う必要がある
- クライアントサイドでの情報取得は最小限にし、詳細な処理はサーバーサイドで行うことが推奨

---

## 通知機能

### LINE ミニアプリ

- **サービスメッセージ API によるプッシュ通知**: 可能
- **通知方法**: LINE のトーク上でメッセージ送信
- **制限**: LINE プラットフォームへの大量リクエストは禁止
- **料金**: 無料枠あり（詳細は要確認）

### LIFF アプリ

- **サービスメッセージ API は利用不可**（通知送信ができない）
- ユーザーがアプリを開いた時のみ情報を表示可能（プッシュ通知は不可）

---

## 予約システム実装の可能性

- **実装可能**: スシローなどの導入事例あり
- **フロー実現**: Webhook + Messaging API で双方向通信が可能
- **承認フロー**: ボタンやリッチメッセージで承認 UI を実装可能
- **Google Calendar 連携**: バックエンドで Google Calendar API と連携可能

---

## 他選択肢との比較

- **Web アプリ**: インストール不要だが、LINE との連携が弱い
- **ネイティブアプリ**: 開発コスト高、インストール必要
- **LINE アプリ**: 既存の LINE 利用フローと一致、通知が自然、開発コストは中程度

---

## 開発手順（概要）

1. LINE Developers コンソールでアカウント作成
2. LINE 公式アカウント/チャネル作成
3. Messaging API チャネルの作成・API キー取得
4. LIFF アプリまたは LINE ミニアプリの開発
5. Webhook エンドポイントの実装
6. Google Calendar API との連携開発
7. テスト・審査・公開

---

## 注意点

- 開発ガイドラインの遵守が必要
- ユーザー情報の安全な取り扱い
- ログの保存（問題調査のため）
- 大量リクエストの禁止

---

## 参考リンク

- [LINE Developers 公式ドキュメント](https://developers.line.biz/ja/docs/)
- [LINE ミニアプリ開発ガイドライン](https://developers.line.biz/ja/docs/line-mini-app/development-guidelines/)
- [LIFF アプリ開発ガイドライン](https://developers.line.biz/ja/docs/liff/development-guidelines/)
