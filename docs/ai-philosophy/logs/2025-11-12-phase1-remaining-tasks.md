# Phase 1（要件定義フェーズ）残作業リスト

**作成日**: 2025-11-12
**関連**: [Phase 1 要件定義](./2025-11-11-phase1-requirements.md)、[MVP プラン](../design/mvp-plan.md)

---

## 概要

Phase 1（探索・プロトタイピング）で残っている作業をリストアップ。技術検証、設計詳細化、MVP実装、美容師との合意形成、ドキュメント整備の5つの領域に分けて整理。

---

## 1. 技術検証・実装確認

### Google Calendar API 関連

- [x] **Google Calendar API 認可フローの最小動作確認** ✅ 完了（2025-11-12）
  - ✅ ローカル/テストカレンダーでの動作検証
  - ✅ OAuth 2.0 フローの実装確認
  - ✅ トークン管理の動作確認
  - ✅ リフレッシュトークンの自動更新確認
  - **実装場所**: `prototypes/mvp/calendar-auth-test/`
  - **検証結果**: すべての動作確認項目OK。技術的実装可能性を確認。
  - **参考**: [Google Calendar API 認可フロー調査](../research/google-calendar-api-auth-flow.md)

- [x] **Google Calendar 予定フォーマット取り決め案の作成** ✅ 完了（2025-11-12）
  - ✅ アプリで作成した予定の識別方法（extendedProperties.private + descriptionマーカー）
  - ✅ 手入力予定との区別方法（source フィールド）
  - ✅ 予約情報（メニュー、顧客名、連絡手段）の記録方法
  - ✅ タイムゾーンの扱い（Asia/Tokyo 固定、ISO 8601形式）
  - ✅ 美容師との合意事項チェックリスト作成
  - **ドキュメント**: [Google Calendar 予定フォーマット仕様](../design/google-calendar-event-format.md)
  - **次のステップ**: 美容師との合意形成（セクション4参照）

### LINE LIFF SDK 関連

- [ ] **LIFF SDK によるユーザー情報取得の実装方法確認**
  - `liff.getProfile()` の動作確認
  - LINE ユーザー ID と表示名の取得
  - 認証状態管理の実装方法
  - エラーハンドリング（LIFF初期化失敗、権限拒否等）
  - **優先度**: 高（お客さん側機能の基盤）

---

## 2. 設計の詳細化

### ビジネスロジック設計

- [ ] **空き枠判定の設計スケッチ**
  - 所要時間・バッファの扱い
  - 二重予約防止ロジックの詳細設計
  - 同時リクエスト時の競合制御（Firestore トランザクション）
  - MVP vs Phase 2 の機能範囲明確化
    - MVP: 重複チェックのみ
    - Phase 2: 所要時間・バッファ考慮
  - **優先度**: 中（MVP は簡易実装）

- [ ] **3段階承認フローの UI/UX スケッチ検証**
  - 既に `prototypes/ui-sketches/` に10個のプロトタイプあり
    - `customer-home.html`
    - `customer-create-request.html`
    - `customer-create-request-calendar.html`
    - `customer-requests.html`
    - `stylist-auth.html`
    - `stylist-requests.html`
    - `stylist-request-detail.html`
    - `stylist-request-detail-adjusting.html`
    - `stylist-request-edit.html`
    - `index.html`
  - プロトタイプのレビューと改善点抽出
  - 美容師へのフィードバック収集
  - フロー全体の整合性確認
  - **優先度**: 中（実装前に確認）

### 新機能設計

- [ ] **長期休暇のお知らせ機能の設計**
  - 表示方法の決定
    - トップページに常時表示？
    - 予約画面に表示？
    - 両方？
  - 管理方法（設定UI、データ保存）
  - データモデル設計
  - 優先度確認（MVP に含めるか Phase 2 か）
  - **優先度**: 低（Phase 2 推奨）

- [ ] **手入力予定の読み取り・反映の設計検討**
  - 双方向同期の実装方針
  - Google Calendar からの予定読み取り方法
  - ポーリング vs Webhook（Push通知）
  - 競合解決の方針（アプリ作成 vs 手入力の優先順位）
  - 予定の識別方法（アプリ作成予定のマーキング）
  - 優先度確認（MVP に含めるか Phase 2 か）
  - **優先度**: 低（Phase 2 推奨）

---

## 3. MVP 実装準備

- [ ] **最小 MVP の実装と検証**（`prototypes/mvp/`）
  - カレンダー反映の最小 MVP
    - LIFF 認証
    - 予約リクエスト作成
    - Google Calendar 連携
  - LIFF 認証の動作確認
  - Google Calendar API の統合確認
  - エンドツーエンドの動作検証
    - お客さん側: リクエスト作成
    - 美容師側: リクエスト承認
    - Google Calendar: 予定作成
  - **優先度**: 高（技術スタック全体の検証）

- [ ] **プロトタイプから本実装への移行計画**
  - 学びの文書化（1-3行）
    - UI/UX プロトタイプから得た学び
    - MVP実装から得た学び
  - 要件の最終確認
  - Phase 2 実装開始の Go/No-Go 判断基準
    - 技術的な実装可能性が確認できたか
    - 美容師との合意が取れたか
    - 要件が明確になったか
  - **優先度**: 中（Phase 2 移行前に実施）

---

## 4. 美容師との合意形成

- [ ] **Google Calendar 予定フォーマットの合意**
  - 予定タイトルの形式
  - 説明欄の記載内容
  - 識別用のタグやラベル
  - タイムゾーンの扱い
  - **優先度**: 高（実装前に必須）

- [ ] **UI/UX プロトタイプのレビュー**
  - プロトタイプのデモ
  - 使い勝手の確認
  - 改善要望の収集
  - **優先度**: 中（実装前に確認）

- [ ] **運用フローの最終確認**
  - 予約リクエスト受付の流れ
  - 承認/調整/拒否の判断基準
  - 既存LINE/口頭フローとの併存方法
  - **優先度**: 中（運用開始前に必須）

- [ ] **追加要件のヒアリング**
  - 見落としている要件の確認
  - 優先度の再確認
  - Phase 2 以降の機能要望
  - **優先度**: 低（随時実施）

---

## 5. ドキュメント整備

- [ ] **Phase 1 要件ログの更新**
  - 技術検証結果の反映
  - 設計決定事項の追記
  - オープンな質問の更新（解決済み/新規）
  - **優先度**: 中（進捗に応じて随時更新）

- [ ] **Phase 1 完了レポート作成**
  - 学びのまとめ
    - 技術検証から得た学び
    - UI/UX プロトタイプから得た学び
    - MVP実装から得た学び
  - Phase 2 への移行条件確認
    - 技術的実装可能性
    - 要件の明確化
    - 美容師との合意
  - リスク・課題の再整理
  - 次のアクションアイテム
  - **優先度**: 中（Phase 2 移行前に実施）

---

## 推奨作業順序

### ステップ1: 技術検証（最優先）

実装可能性の確認が最優先。技術的なブロッカーがないか確認する。

1. Google Calendar API 認可フロー確認
2. LIFF SDK ユーザー情報取得確認

### ステップ2: MVP 実装

技術スタック全体の動作確認。エンドツーエンドで動くか検証。

3. `prototypes/mvp/` でエンドツーエンド検証

### ステップ3: 設計詳細化

実装前の最終設計。ビジネスロジックの詳細を詰める。

4. 空き枠判定の設計
5. Google Calendar 予定フォーマット取り決め

### ステップ4: 美容師合意

要件の最終確定。美容師の期待と実装内容を合わせる。

6. UI/UX レビュー
7. 運用フロー確認
8. 予定フォーマット合意

### ステップ5: Phase 2 移行準備

Phase 2 実装開始の準備。

9. ドキュメント整備
10. 学びの文書化
11. Phase 1 完了レポート作成

---

## Phase 2 移行の判断基準（Go/No-Go）

以下の条件が揃えば Phase 2（本実装）に移行可能：

- [ ] **技術的実装可能性が確認できた**
  - ✅ Google Calendar API が期待通り動作
  - [ ] LIFF SDK が期待通り動作
  - [ ] エンドツーエンドで動作確認済み

- [ ] **要件が明確になった**
  - 機能要件が明確
  - 非機能要件が明確
  - MVP範囲が明確

- [ ] **美容師との合意が取れた**
  - UI/UX が合意済み
  - 運用フローが合意済み
  - 予定フォーマットが合意済み

- [ ] **リスクが許容範囲**
  - 技術的リスクが洗い出され、対策が立てられている
  - 運用リスクが洗い出され、対策が立てられている

---

## 参考資料

- [Phase 1 要件定義](./2025-11-11-phase1-requirements.md)
- [MVP 作成プラン](../design/mvp-plan.md)
- [システム設計](../design/system-design.md)
- [アーキテクチャ設計ガイドライン](../design/architecture-guidelines.md)

---

## 更新履歴

- **2025-11-12**: 初版作成（Phase 1 残作業リストを整理）
- **2025-11-12**: Google Calendar API 認可フロー技術検証完了を反映
- **2025-11-12**: Google Calendar 予定フォーマット取り決め案作成完了を反映
